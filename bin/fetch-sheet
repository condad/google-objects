#!/usr/bin/env python

import os
import logging

import fire

from google_objects import SheetsClient

log = logging.getLogger(__name__)


class SheetFetcher(object):

    """Command line tool for fetching tabular data
    and redirecting it to STDOUT."""

    def __init__(self, spreadsheet=None, key=None):
        """Authenticate the Google API Client and loads the Specified Spreadsheet"""
        if not spreadsheet:
            raise ValueError("Spreadsheet argument required.")

        if not key:
            key = os.getenv('GOOGLE_SHEETS_API_KEY')

        if key:
            self.client = SheetsClient.from_api_key(key)
        else:
            self.client = SheetsClient.from_service_account()
            self.spreadsheet = self.client.get_spreadsheet(spreadsheet)

    def sheet(self, sheet='Sheet1'):
        sheet = self.spreadsheet.get_sheet_by_name(sheet)
        dataframe = sheet.frame()

        print(dataframe.to_json(orient='records'))
        

if __name__ == "__main__":
    fire.Fire(SheetFetcher)
